// -----------------------------
// i18n (English / French)
// -----------------------------
const I18N = {
  en: {
    "meta.title": "Alexandre Math Hub | Free Calculus Notes & Practice",
    "meta.description": "Free explanations and exam-style practice for CEGEP & university math: Differential, Integral, and Vector Calculus. Optional tutoring available.",

    "topbar.aria": "Site notice",
    "topbar.text": "Free notes + exam practice added regularly.",
    "topbar.link": "Browse the library",

    "brand.aria": "Alexandre Math Hub home",
    "brand.name": "Alexandre Math Hub",
    "brand.tagline": "Free notes • Practice • Exam packs",

    "nav.aria": "Primary navigation",
    "nav.openMenu": "Open menu",
    "nav.courses": "Courses",
    "nav.examReview": "Exam review",
    "nav.cheatsheets": "Cheatsheets",
    "nav.tutoring": "Tutoring",
    "nav.faq": "FAQ",
    "nav.ask": "Ask a question",

    "hero.h1": "Free calculus explanations + exam-style practice.",
    "hero.lead": "Clear, step-by-step help for <strong>CEGEP</strong> and <strong>university</strong> math: <strong>Differential</strong>, <strong>Integral</strong>, and <strong>Vector Calculus</strong>.",
    "hero.ctaBrowse": "Browse courses",
    "hero.ctaExam": "Try an exam pack",
    "hero.ctaTutoring": "Need 1-on-1?",
    "hero.ctaTutoringAria": "Optional tutoring",

"quiz.back": "← Back to exam review",
"quiz.title": "Differential Calculus Quizzes",
"quiz.subtitle": "Choose a level. Get instant correction + explanations.",
"quiz.pickLevel": "Pick a level",
"quiz.easy": "Easy",
"quiz.hard": "Hard",
"quiz.veryHard": "Very hard",
"quiz.reset": "Reset",
"quiz.submit": "Submit",
"quiz.retry": "Retry",
"quiz.whatToDo": "What to do after",
"quiz.after1": "Redo the ones you missed WITHOUT looking.",
"quiz.after2": "Then do 5 mixed practice questions from the library.",
"quiz.after3": "Aim for 80%+ before your midterm.",
"quiz.tipTitle": "Tip",
"quiz.tipText": "Hard mode is designed to feel like a real exam.",
"quiz.scoreLine": "Score",
"quiz.missing": "Answer all questions before submitting.",


    "trust.simpleTitle": "Simple",
    "trust.simpleText": "Concept → example → practice",
    "trust.examTitle": "Exam-focused",
    "trust.examText": "Common patterns + time savers",
    "trust.structuredTitle": "Structured",
    "trust.structuredText": "Same format on every topic",

    "quickstart.aria": "Quick start",
    "quickstart.title": "Start here",
    "quickstart.step1": "Pick a topic from the library",
    "quickstart.step2": "Read the 2-minute explanation",
    "quickstart.step3": "Do 5–10 practice questions",
    "quickstart.step4": "Check solutions (optional)",
    "quickstart.step5": "Try a timed mini-exam",
    "quickstart.openLibrary": "Open the library",
    "quickstart.tip": "Tip: use the search to find your exact chapter fast.",

    "pill.differential": "Differential",
    "pill.integral": "Integral",
    "pill.vector": "Vector",
    "pill.langs": "English / French",

    "library.title": "Course library",
    "library.subtitle": "Search topics, then open a page with explanation + examples + practice.",

    "library.popularTitle": "Popular topics",
    "library.popularSubtitle": "Quick access to the most-used chapters.",
    "library.searchLabel": "Search topics",
    "library.searchPlaceholder": "Search a topic (e.g., substitution, optimization, partial derivatives…)",
    "library.filtersAria": "Topic filters",
    "library.cardsAria": "Topic cards",

    "filter.all": "All",
    "filter.differential": "Differential",
    "filter.integral": "Integral",
    "filter.vector": "Vector",

    "callout.title": "Want a topic added?",
    "callout.text": "Send your chapter title or a screenshot of the homework and I’ll add a matching practice set.",
    "callout.button": "Request a topic",

    "exams.title": "Exam review packs",
    "exams.subtitle": "Timed sets you can do in 30–90 minutes. (Add PDFs/links as you publish them.)",
    "exams.cardsAria": "Exam pack cards",
    "exams.comingSoon": "Coming soon: “Generate a custom exam” by selecting topics + difficulty.",

    "resources.title": "Cheatsheets & tools",
    "resources.subtitle": "Fast references: formulas, method maps, and common mistakes.",
    "resources.cardsAria": "Resource cards",

    "tutoring.title": "Optional tutoring",
    "tutoring.subtitle": "If you want 1-on-1 help, here are simple options. The site stays free.",
    "tutoring.singleTitle": "Single Session",
    "tutoring.perHour": "/ 60 min",
    "tutoring.single1": "Homework help or topic review",
    "tutoring.single2": "Shared notes + recap",
    "tutoring.single3": "Online or in-person",
    "tutoring.singleBtn": "Ask about a session",
    "tutoring.popularAria": "Most popular plan",
    "tutoring.popularBadge": "Most Popular",
    "tutoring.weeklyTitle": "Weekly Plan",
    "tutoring.per4": "/ 4 sessions",
    "tutoring.weekly1": "Weekly structure + accountability",
    "tutoring.weekly2": "Practice sets (optional)",
    "tutoring.weekly3": "Exam pacing + strategy",
    "tutoring.weeklyBtn": "Ask about weekly",
    "tutoring.examTitle": "Exam Prep",
    "tutoring.per3h": "/ 3 hours",
    "tutoring.exam1": "Focus on what will be tested",
    "tutoring.exam2": "Timed drills + corrections",
    "tutoring.exam3": "Personal “what to memorize” sheet",
    "tutoring.examBtn": "Ask about exam prep",
    "tutoring.note": "Replace prices with your real rates (or hide this whole section if you want 100% free).",

    "faq.title": "FAQ",
    "faq.subtitle": "Quick answers.",
    "faq.q1": "Is everything on this site free?",
    "faq.a1": "Yes. Notes, explanations, practice questions, and exam packs are free. Tutoring is optional.",
    "faq.q2": "Can I request a specific chapter/topic?",
    "faq.a2": "Yes—send the topic name (or a screenshot of your homework). I’ll try to add it to the library.",
    "faq.q3": "Do you post solutions?",
    "faq.a3": "Some pages include full solutions; others have answers first with “show solution” steps.",
    "faq.q4": "Do you tutor online?",
    "faq.a4": "Yes. Online sessions use a shared whiteboard and work well for most calculus courses.",

    "contact.title": "Ask a question / Contact",
    "contact.subtitle": "Request a topic, report an error, or ask about tutoring. I’ll reply quickly.",
    "contact.name": "Name",
    "contact.namePh": "Your name",
    "contact.email": "Email",
    "contact.emailPh": "you@email.com",
    "contact.about": "What is this about?",
    "contact.courseTopic": "Course / Topic",
    "contact.topicPh": "e.g., Calculus I — optimization",
    "contact.message": "Message",
    "contact.msgPh": "Paste the question, chapter title, or what you’re stuck on. Include your exam date if you have one.",
    "contact.send": "Send",
    "contact.formNote": "This demo form shows a success message. For real emails, connect it to Formspree / Netlify Forms / your backend.",
    "contact.opt1": "Request a topic / practice set",
    "contact.opt2": "Question about a solution",
    "contact.opt3": "Report an error",
    "contact.opt4": "Tutoring inquiry",
    "contact.opt5": "Other",
    "contact.whatIPost": "What I post",
    "contact.post1": "Short explanations in simple words",
    "contact.post2": "Exam-style questions (easy → hard)",
    "contact.post3": "Common mistakes + quick checks",
    "contact.emailTitle": "Email",
    "contact.replaceEmail": "Replace with your real email.",

    "footer.brand": "Alexandre Math Hub",
    "footer.copyright": "© <span id=\"year\"></span> — Free learning resources.",
    "footer.courses": "Courses",
    "footer.exams": "Exam review",
    "footer.resources": "Cheatsheets",
    "footer.tutoring": "Tutoring",
    "footer.contact": "Contact",
    "footer.top": "Back to top ↑",

    // dynamic UI strings
    "ui.open": "Open →",
    "ui.new": "New",
    "ui.back": "Back to library",
    "topic.section.explain": "2-minute explanation",
    "topic.section.examples": "Worked examples",
    "topic.section.practice": "Practice",
    "topic.section.quiz": "Quick quiz",
    "topic.coming.title": "Content coming soon",
    "topic.coming.text": "This page will include: a short explanation, worked examples, and exam-style practice (easy → hard).",

    "topic.back": "← Back to library",
    "topic.onThisPage": "On this page",
    "topic.section.overview": "Overview",
    "topic.section.examples": "Worked examples",
    "topic.section.practice": "Practice",
    "topic.section.quiz": "Quick quiz",
    "topic.section.request": "Request this topic",
    "topic.requestText": "Want this page finished sooner? Send your chapter title or a screenshot.",
    "ui.noResults": "No results. Try a different search.",
    "ui.formThanks": "Thanks",
    "ui.formReady": "Your message is ready to send. Connect this form to Formspree/Netlify Forms to receive emails.",

    // topic meta labels
    "level.cegep_uni": "CEGEP / Uni",
    "level.uni": "Uni",
    "cat.differential": "Differential",
    "cat.integral": "Integral",
    "cat.vector": "Vector",

    // sample content (cards)
    "topic.limits.title": "Limits & continuity",
    "topic.limits.desc": "One-sided limits, continuity tests, and how to spot indeterminate forms.",
    "topic.derivativeRules.title": "Derivative rules (fast + safe)",
    "topic.derivativeRules.desc": "Power/product/quotient/chain rules with common exam traps.",
    "topic.optimization.title": "Optimization patterns",
    "topic.optimization.desc": "Setup strategy + what to write so the grader gives full marks.",
    "topic.uSub.title": "u-Substitution",
    "topic.uSub.desc": "When to choose u, how to check, and how to avoid sign errors.",
    "topic.ibp.title": "Integration by parts",
    "topic.ibp.desc": "How to pick u/dv and what to do when it repeats (tabular method).",
    "topic.planes.title": "Planes, normals, dot & cross",
    "topic.planes.desc": "Find equations of planes, normals, and angle tests quickly.",
    "topic.partials.title": "Partial derivatives & gradient",
    "topic.partials.desc": "Compute partials, interpret gradient, and do tangent plane questions.",
    "topic.multipleIntegrals.title": "Multiple integrals (setup)",
    "topic.multipleIntegrals.desc": "Choosing order of integration and setting bounds clearly.",

    "exam.derivatives.title": "Mini-Exam: Derivatives (45 min)",
    "exam.derivatives.desc": "Rules + applications. Great before a midterm.",
    "exam.integrals.title": "Mini-Exam: Integrals (60 min)",
    "exam.integrals.desc": "Substitution + parts + area/volume setups.",
    "exam.vectors.title": "Mini-Exam: Vectors & planes (60 min)",
    "exam.vectors.desc": "3D geometry fundamentals with fast checks.",

    "res.methodMap.title": "Integration method map",
    "res.methodMap.desc": "A “when to use what” decision tree (substitution, parts, trig, etc.).",
    "res.derivSheet.title": "Derivative rules sheet",
    "res.derivSheet.desc": "All the rules + the 5 most common exam mistakes.",
    "res.vectorFormulas.title": "Vector formulas quick list",
    "res.vectorFormulas.desc": "Dot, cross, projections, distance to plane, and angle tests.",

    // tags
    "tag.limits": "limits",
    "tag.continuity": "continuity",
    "tag.algebraChecks": "algebra checks",
    "tag.derivatives": "derivatives",
    "tag.chainRule": "chain rule",
    "tag.commonMistakes": "common mistakes",
    "tag.maxMin": "max/min",
    "tag.setup": "setup",
    "tag.wordProblems": "word problems",
    "tag.substitution": "substitution",
    "tag.patterns": "patterns",
    "tag.checkStep": "check step",
    "tag.ibp": "IBP",
    "tag.tabular": "tabular",
    "tag.repetition": "repetition",
    "tag.planes": "planes",
    "tag.normalVector": "normal vector",
    "tag.dotCross": "dot/cross",
    "tag.partials": "partials",
    "tag.gradient": "gradient",
    "tag.tangentPlane": "tangent plane",
    "tag.doubleIntegral": "double integral",
    "tag.bounds": "bounds",
    "tag.order": "order",
    "tag.timed": "timed",
    "tag.cegep": "CEGEP",
    "tag.integrals": "integrals",
    "tag.examPatterns": "exam patterns",
    "tag.vectors": "vectors",
    "tag.strategy": "strategy",
    "tag.cheatsheet": "cheatsheet",
    "tag.formulas": "formulas",
  },

  fr: {
    "meta.title": "Alexandre Math Hub | Notes & exercices gratuits en calcul",
    "meta.description": "Explications gratuites et exercices style examen pour les maths au CÉGEP et à l’université : calcul différentiel, intégral et vectoriel. Tutorat optionnel.",

    "topbar.aria": "Avis du site",
    "topbar.text": "Notes gratuites + pratique style examen ajoutées régulièrement.",
    "topbar.link": "Parcourir la bibliothèque",

    "brand.aria": "Accueil Alexandre Math Hub",
    "brand.name": "Alexandre Math Hub",
    "brand.tagline": "Notes gratuites • Pratique • Examens",

    "nav.aria": "Navigation principale",
    "nav.openMenu": "Ouvrir le menu",
    "nav.courses": "Cours",
    "nav.examReview": "Révision d’examen",
    "nav.cheatsheets": "Fiches",
    "nav.tutoring": "Tutorat",
    "nav.faq": "FAQ",
    "nav.ask": "Poser une question",


"quiz.back": "← Retour à la révision",
"quiz.title": "Quiz de calcul différentiel",
"quiz.subtitle": "Choisis un niveau. Correction instantanée + explications.",
"quiz.pickLevel": "Choisir un niveau",
"quiz.easy": "Facile",
"quiz.hard": "Difficile",
"quiz.veryHard": "Très difficile",
"quiz.reset": "Réinitialiser",
"quiz.submit": "Soumettre",
"quiz.retry": "Recommencer",
"quiz.whatToDo": "Après le quiz",
"quiz.after1": "Refais celles que tu as manquées SANS regarder.",
"quiz.after2": "Ensuite fais 5 questions mixtes de la bibliothèque.",
"quiz.after3": "Vise 80%+ avant l’intra.",
"quiz.tipTitle": "Astuce",
"quiz.tipText": "Le mode difficile est conçu comme un vrai examen.",
"quiz.scoreLine": "Résultat",
"quiz.missing": "Réponds à toutes les questions avant de soumettre.",


    "hero.h1": "Explications gratuites en calcul + exercices style examen.",
    "hero.lead": "Aide claire, étape par étape, pour les maths au <strong>CÉGEP</strong> et à l’<strong>université</strong> : <strong>calcul différentiel</strong>, <strong>intégral</strong> et <strong>vectoriel</strong>.",
    "hero.ctaBrowse": "Voir les cours",
    "hero.ctaExam": "Essayer un examen",
    "hero.ctaTutoring": "Besoin d’aide 1-1 ?",
    "hero.ctaTutoringAria": "Tutorat optionnel",

    "trust.simpleTitle": "Simple",
    "trust.simpleText": "Concept → exemple → pratique",
    "trust.examTitle": "Orienté examen",
    "trust.examText": "Méthodes + astuces rapides",
    "trust.structuredTitle": "Structuré",
    "trust.structuredText": "Même format pour chaque sujet",

    "quickstart.aria": "Démarrage rapide",
    "quickstart.title": "Commencer ici",
    "quickstart.step1": "Choisis un sujet dans la bibliothèque",
    "quickstart.step2": "Lis l’explication (2 minutes)",
    "quickstart.step3": "Fais 5 à 10 questions",
    "quickstart.step4": "Vérifie les solutions (optionnel)",
    "quickstart.step5": "Essaie un mini-examen chronométré",
    "quickstart.openLibrary": "Ouvrir la bibliothèque",
    "quickstart.tip": "Astuce : utilise la recherche pour trouver ton chapitre rapidement.",

    "pill.differential": "Différentiel",
    "pill.integral": "Intégral",
    "pill.vector": "Vectoriel",
    "pill.langs": "Anglais / Français",

    "library.title": "Bibliothèque de cours",
    "library.subtitle": "Cherche un sujet, puis ouvre une page avec explication + exemples + pratique.",

    "library.popularTitle": "Sujets populaires",
    "library.popularSubtitle": "Accès rapide aux chapitres les plus utilisés.",
    "library.searchLabel": "Rechercher des sujets",
    "library.searchPlaceholder": "Rechercher un sujet (ex. substitution, optimisation, dérivées partielles…)",
    "library.filtersAria": "Filtres de sujets",
    "library.cardsAria": "Cartes de sujets",

    "filter.all": "Tout",
    "filter.differential": "Différentiel",
    "filter.integral": "Intégral",
    "filter.vector": "Vectoriel",

    "callout.title": "Tu veux un sujet ajouté ?",
    "callout.text": "Envoie le titre du chapitre ou une capture du devoir, et j’ajouterai une série de pratique correspondante.",
    "callout.button": "Demander un sujet",

    "exams.title": "Packs de révision d’examen",
    "exams.subtitle": "Séries chronométrées de 30 à 90 minutes. (Ajoute des PDFs/liens quand tu publies.)",
    "exams.cardsAria": "Cartes d’examens",
    "exams.comingSoon": "Bientôt : « Générer un examen sur mesure » en choisissant sujets + difficulté.",

    "resources.title": "Fiches & outils",
    "resources.subtitle": "Références rapides : formules, cartes de méthodes, erreurs fréquentes.",
    "resources.cardsAria": "Cartes de ressources",

    "tutoring.title": "Tutorat optionnel",
    "tutoring.subtitle": "Si tu veux de l’aide 1-1, voici des options simples. Le site reste gratuit.",
    "tutoring.singleTitle": "Séance unique",
    "tutoring.perHour": "/ 60 min",
    "tutoring.single1": "Aide devoirs ou révision",
    "tutoring.single2": "Notes partagées + résumé",
    "tutoring.single3": "En ligne ou en personne",
    "tutoring.singleBtn": "Demander une séance",
    "tutoring.popularAria": "Forfait le plus populaire",
    "tutoring.popularBadge": "Le + populaire",
    "tutoring.weeklyTitle": "Forfait hebdo",
    "tutoring.per4": "/ 4 séances",
    "tutoring.weekly1": "Structure + suivi chaque semaine",
    "tutoring.weekly2": "Séries de pratique (optionnel)",
    "tutoring.weekly3": "Rythme d’examen + stratégie",
    "tutoring.weeklyBtn": "Demander le forfait",
    "tutoring.examTitle": "Prépa d’examen",
    "tutoring.per3h": "/ 3 heures",
    "tutoring.exam1": "Focus sur ce qui sera évalué",
    "tutoring.exam2": "Drills chronométrés + correction",
    "tutoring.exam3": "Fiche perso « à mémoriser »",
    "tutoring.examBtn": "Demander la prépa",
    "tutoring.note": "Remplace les prix par tes vrais tarifs (ou cache cette section si tu veux 100% gratuit).",

    "faq.title": "FAQ",
    "faq.subtitle": "Réponses rapides.",
    "faq.q1": "Tout est gratuit sur ce site ?",
    "faq.a1": "Oui. Notes, explications, exercices et packs d’examen sont gratuits. Le tutorat est optionnel.",
    "faq.q2": "Je peux demander un chapitre/sujet précis ?",
    "faq.a2": "Oui — envoie le nom du sujet (ou une capture de ton devoir). J’essaierai de l’ajouter à la bibliothèque.",
    "faq.q3": "Tu publies les solutions ?",
    "faq.a3": "Certaines pages ont des solutions complètes; d’autres montrent d’abord les réponses puis des étapes « afficher la solution ».",
    "faq.q4": "Tu fais du tutorat en ligne ?",
    "faq.a4": "Oui. En ligne avec tableau partagé, ça fonctionne très bien pour la plupart des cours de calcul.",

    "contact.title": "Poser une question / Contact",
    "contact.subtitle": "Demande un sujet, signale une erreur ou informe-toi sur le tutorat. Je réponds rapidement.",
    "contact.name": "Nom",
    "contact.namePh": "Ton nom",
    "contact.email": "Courriel",
    "contact.emailPh": "toi@courriel.com",
    "contact.about": "À propos de quoi ?",
    "contact.courseTopic": "Cours / Sujet",
    "contact.topicPh": "ex. Calcul I — optimisation",
    "contact.message": "Message",
    "contact.msgPh": "Colle la question, le titre du chapitre, ou ce qui te bloque. Indique la date d’examen si tu l’as.",
    "contact.send": "Envoyer",
    "contact.formNote": "Ce formulaire démo affiche un message de succès. Pour recevoir des courriels, connecte-le à Formspree / Netlify Forms / ton backend.",
    "contact.opt1": "Demander un sujet / série de pratique",
    "contact.opt2": "Question sur une solution",
    "contact.opt3": "Signaler une erreur",
    "contact.opt4": "Info tutorat",
    "contact.opt5": "Autre",
    "contact.whatIPost": "Ce que je publie",
    "contact.post1": "Explications courtes avec des mots simples",
    "contact.post2": "Questions style examen (facile → difficile)",
    "contact.post3": "Erreurs fréquentes + vérifications rapides",
    "contact.emailTitle": "Courriel",
    "contact.replaceEmail": "Remplace par ton vrai courriel.",

    "footer.brand": "Alexandre Math Hub",
    "footer.copyright": "© <span id=\"year\"></span> — Ressources gratuites.",
    "footer.courses": "Cours",
    "footer.exams": "Révision",
    "footer.resources": "Fiches",
    "footer.tutoring": "Tutorat",
    "footer.contact": "Contact",
    "footer.top": "Retour en haut ↑",

    // dynamic UI strings
    "ui.open": "Ouvrir →",
    "ui.new": "Nouveau",
    "ui.back": "Retour à la bibliothèque",
    "topic.section.explain": "Explication (2 minutes)",
    "topic.section.examples": "Exemples corrigés",
    "topic.section.practice": "Pratique",
    "topic.section.quiz": "Quiz rapide",
    "topic.coming.title": "Contenu bientôt disponible",
    "topic.coming.text": "Cette page va inclure : une explication courte, des exemples corrigés et de la pratique style examen (facile → difficile).",

    "topic.back": "← Retour à la bibliothèque",
    "topic.onThisPage": "Sur cette page",
    "topic.section.overview": "Aperçu",
    "topic.section.examples": "Exemples corrigés",
    "topic.section.practice": "Pratique",
    "topic.section.quiz": "Mini-quiz",
    "topic.section.request": "Demander ce sujet",
    "topic.requestText": "Tu veux cette page plus vite ? Envoie le titre du chapitre ou une capture d’écran.",
    "ui.noResults": "Aucun résultat. Essaie une autre recherche.",
    "ui.formThanks": "Merci",
    "ui.formReady": "Ton message est prêt. Connecte ce formulaire à Formspree/Netlify Forms pour recevoir les courriels.",

    // topic meta labels
    "level.cegep_uni": "CÉGEP / Uni",
    "level.uni": "Uni",
    "cat.differential": "Différentiel",
    "cat.integral": "Intégral",
    "cat.vector": "Vectoriel",

    // contenu d’exemple (cartes)
    "topic.limits.title": "Limites & continuité",
    "topic.limits.desc": "Limites à gauche/droite, tests de continuité, et comment repérer les formes indéterminées.",
    "topic.derivativeRules.title": "Règles de dérivation (rapide + safe)",
    "topic.derivativeRules.desc": "Règles puissance/produit/quotient/chaîne avec les pièges d’examen.",
    "topic.optimization.title": "Optimisation (patterns)",
    "topic.optimization.desc": "Stratégie de mise en place + quoi écrire pour avoir tous les points.",
    "topic.uSub.title": "Substitution (u-sub)",
    "topic.uSub.desc": "Quand choisir u, comment vérifier, et éviter les erreurs de signe.",
    "topic.ibp.title": "Intégration par parties",
    "topic.ibp.desc": "Comment choisir u/dv et quoi faire quand ça se répète (méthode tabulaire).",
    "topic.planes.title": "Plans, normales, produit scalaire & vectoriel",
    "topic.planes.desc": "Trouver l’équation d’un plan, une normale, et les tests d’angle rapidement.",
    "topic.partials.title": "Dérivées partielles & gradient",
    "topic.partials.desc": "Calculer les partielles, interpréter le gradient, et faire les plans tangents.",
    "topic.multipleIntegrals.title": "Intégrales multiples (setup)",
    "topic.multipleIntegrals.desc": "Choisir l’ordre d’intégration et poser les bornes clairement.",

    "exam.derivatives.title": "Mini-examen : dérivées (45 min)",
    "exam.derivatives.desc": "Règles + applications. Parfait avant un intra.",
    "exam.integrals.title": "Mini-examen : intégrales (60 min)",
    "exam.integrals.desc": "Substitution + parties + mises en place aire/volume.",
    "exam.vectors.title": "Mini-examen : vecteurs & plans (60 min)",
    "exam.vectors.desc": "Bases de géométrie 3D avec vérifications rapides.",

    "res.methodMap.title": "Carte des méthodes d’intégration",
    "res.methodMap.desc": "Un arbre de décision « quand utiliser quoi » (substitution, parties, trig, etc.).",
    "res.derivSheet.title": "Fiche : règles de dérivation",
    "res.derivSheet.desc": "Toutes les règles + les 5 erreurs les plus fréquentes.",
    "res.vectorFormulas.title": "Liste rapide : formules vectorielles",
    "res.vectorFormulas.desc": "Scalaire, vectoriel, projections, distance à un plan, et tests d’angle.",

    // tags
    "tag.limits": "limites",
    "tag.continuity": "continuité",
    "tag.algebraChecks": "vérifs algébriques",
    "tag.derivatives": "dérivées",
    "tag.chainRule": "règle de chaîne",
    "tag.commonMistakes": "erreurs fréquentes",
    "tag.maxMin": "max/min",
    "tag.setup": "mise en place",
    "tag.wordProblems": "problèmes",
    "tag.substitution": "substitution",
    "tag.patterns": "patterns",
    "tag.checkStep": "étape de vérif",
    "tag.ibp": "IPP",
    "tag.tabular": "tabulaire",
    "tag.repetition": "répétition",
    "tag.planes": "plans",
    "tag.normalVector": "vecteur normal",
    "tag.dotCross": "scalaire/vectoriel",
    "tag.partials": "partielles",
    "tag.gradient": "gradient",
    "tag.tangentPlane": "plan tangent",
    "tag.doubleIntegral": "intégrale double",
    "tag.bounds": "bornes",
    "tag.order": "ordre",
    "tag.timed": "chronométré",
    "tag.cegep": "CÉGEP",
    "tag.integrals": "intégrales",
    "tag.examPatterns": "style examen",
    "tag.vectors": "vecteurs",
    "tag.strategy": "stratégie",
    "tag.cheatsheet": "fiche",
    "tag.formulas": "formules",
  }
};

function getLang() {
  const saved = localStorage.getItem("lang");
  if (saved === "fr" || saved === "en") return saved;
  return "en";
}

function t(key) {
  const lang = getLang();
  return (I18N[lang] && I18N[lang][key]) || (I18N.en && I18N.en[key]) || key;
}

function updateYear(){
  const y = document.getElementById("year");
  if (y) y.textContent = String(new Date().getFullYear());
}

function setLanguage(lang) {
  if (lang !== "fr" && lang !== "en") lang = "en";
  localStorage.setItem("lang", lang);
  document.documentElement.lang = lang;

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    el.innerHTML = t(key);
  });

  document.querySelectorAll("[data-i18n-aria]").forEach((el) => {
    const key = el.getAttribute("data-i18n-aria");
    el.setAttribute("aria-label", t(key));
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
    const key = el.getAttribute("data-i18n-placeholder");
    el.setAttribute("placeholder", t(key));
  });

  document.querySelectorAll("[data-i18n-content]").forEach((el) => {
    const key = el.getAttribute("data-i18n-content");
    el.setAttribute("content", t(key));
  });

  updateYear();

  const langToggle = document.getElementById("langToggle");
  if (langToggle) {
    langToggle.textContent = lang === "en" ? "FR" : "EN";
    langToggle.setAttribute("aria-label", lang === "en" ? "Passer en français" : "Switch to English");
  }

  renderAllCards();
}

// -----------------------------
// Mobile nav toggle
// -----------------------------
const navToggle = document.getElementById("navToggle");
const navMenu = document.getElementById("navMenu");

if (navToggle && navMenu) {
  navToggle.addEventListener("click", () => {
    const isOpen = navMenu.classList.toggle("is-open");
    navToggle.setAttribute("aria-expanded", String(isOpen));
  });

  navMenu.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => {
      navMenu.classList.remove("is-open");
      navToggle.setAttribute("aria-expanded", "false");
    });
  });
}

const langToggle = document.getElementById("langToggle");
if (langToggle) {
  langToggle.addEventListener("click", () => {
    const next = getLang() === "en" ? "fr" : "en";
    setLanguage(next);
  });
}

updateYear();

// -----------------------------
// Library / Exam / Resources data
// -----------------------------
const TOPICS = [
  {
    slug: "limits",
    titleKey: "topic.limits.title",
    category: "differential",
    levelKey: "level.cegep_uni",
    descKey: "topic.limits.desc",
    tagKeys: ["tag.limits", "tag.continuity", "tag.algebraChecks"],
    popular: true,
    isNew: false,
    url: "topics/limits.html",
  },
  {
    slug: "derivative-rules",
    titleKey: "topic.derivativeRules.title",
    category: "differential",
    levelKey: "level.cegep_uni",
    descKey: "topic.derivativeRules.desc",
    tagKeys: ["tag.derivatives", "tag.chainRule", "tag.commonMistakes"],
    popular: true,
    isNew: true,
    url: "topics/derivative-rules.html",
  },
  {
    slug: "optimization",
    titleKey: "topic.optimization.title",
    category: "differential",
    levelKey: "level.cegep_uni",
    descKey: "topic.optimization.desc",
    tagKeys: ["tag.maxMin", "tag.setup", "tag.wordProblems"],
    popular: true,
    isNew: false,
    url: "topics/optimization.html",
  },
  {
    slug: "u-sub",
    titleKey: "topic.uSub.title",
    category: "integral",
    levelKey: "level.cegep_uni",
    descKey: "topic.uSub.desc",
    tagKeys: ["tag.substitution", "tag.patterns", "tag.checkStep"],
    popular: true,
    isNew: true,
    url: "topics/u-sub.html",
  },
  {
    slug: "ibp",
    titleKey: "topic.ibp.title",
    category: "integral",
    levelKey: "level.cegep_uni",
    descKey: "topic.ibp.desc",
    tagKeys: ["tag.ibp", "tag.tabular", "tag.repetition"],
    popular: true,
    isNew: false,
    url: "topics/ibp.html",
  },
  {
    slug: "planes",
    titleKey: "topic.planes.title",
    category: "vector",
    levelKey: "level.uni",
    descKey: "topic.planes.desc",
    tagKeys: ["tag.planes", "tag.normalVector", "tag.dotCross"],
    popular: false,
    isNew: false,
    url: "topics/planes.html",
  },
  {
    slug: "partials",
    titleKey: "topic.partials.title",
    category: "vector",
    levelKey: "level.uni",
    descKey: "topic.partials.desc",
    tagKeys: ["tag.partials", "tag.gradient", "tag.tangentPlane"],
    popular: false,
    isNew: false,
    url: "topics/partials.html",
  },
  {
    slug: "multiple-integrals",
    titleKey: "topic.multipleIntegrals.title",
    category: "vector",
    levelKey: "level.uni",
    descKey: "topic.multipleIntegrals.desc",
    tagKeys: ["tag.doubleIntegral", "tag.bounds", "tag.order"],
    popular: false,
    isNew: true,
    url: "topics/multiple-integrals.html",
  },
];

const EXAMS = [
  {
    titleKey: "exam.derivatives.title",
    descKey: "exam.derivatives.desc",
    tagKeys: ["tag.timed", "tag.derivatives", "tag.cegep"],
url: "quiz.html?set=diff-easy",
  },
  {
    titleKey: "exam.integrals.title",
    descKey: "exam.integrals.desc",
    tagKeys: ["tag.timed", "tag.integrals", "tag.examPatterns"],
    url: "#contact",
  },
  {
    titleKey: "exam.vectors.title",
    descKey: "exam.vectors.desc",
    tagKeys: ["tag.timed", "tag.vectors", "tag.planes"],
    url: "#contact",
  },
];

const RESOURCES = [
  {
    titleKey: "res.methodMap.title",
    descKey: "res.methodMap.desc",
    tagKeys: ["tag.integrals", "tag.strategy"],
    url: "#contact",
  },
  {
    titleKey: "res.derivSheet.title",
    descKey: "res.derivSheet.desc",
    tagKeys: ["tag.derivatives", "tag.cheatsheet"],
    url: "#contact",
  },
  {
    titleKey: "res.vectorFormulas.title",
    descKey: "res.vectorFormulas.desc",
    tagKeys: ["tag.vectors", "tag.formulas"],
    url: "#contact",
  },
];

// -----------------------------
// Rendering
// -----------------------------
function escapeHtml(str) {
  return String(str)
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

function renderCard({ title, desc, tags = [], url = "#", meta, badge }) {
  const tagHtml = tags
    .slice(0, 6)
    .map((tt) => `<span class="tag">${escapeHtml(tt)}</span>`)
    .join("");

  return `
    <article class="content-card">
      ${badge ? `<div class="badge--new">${escapeHtml(badge)}</div>` : ""}
      <div class="content-card__head">
        <h3 class="content-card__title">${escapeHtml(title)}</h3>
        ${meta ? `<div class="content-card__meta">${escapeHtml(meta)}</div>` : ""}
      </div>
      <p class="muted">${escapeHtml(desc)}</p>
      <div class="tagrow" aria-label="Tags">${tagHtml}</div>
      <a class="content-card__link" href="${escapeHtml(url)}">${escapeHtml(t("ui.open"))}</a>
    </article>
  `;
}

function mountCards({ el, items, type }) {
  if (!el) return;
  if (!items.length) {
    el.innerHTML = `<div class="card"><p class="muted">${escapeHtml(t("ui.noResults"))}</p></div>`;
    return;
  }

  el.innerHTML = items
    .map((item) => {
      if (type === "topic") {
        const meta = `${t(item.levelKey)} • ${t("cat." + item.category)}`;
        return renderCard({
          title: t(item.titleKey),
          desc: t(item.descKey),
          tags: (item.tagKeys || []).map((k) => t(k)),
          url: item.url,
          meta,
          badge: item.isNew ? t("ui.new") : null,
        });
      }
      return renderCard({
        title: t(item.titleKey),
        desc: t(item.descKey),
        tags: (item.tagKeys || []).map((k) => t(k)),
        url: item.url,
      });
    })
    .join("");
}

// -----------------------------
// Filters + search
// -----------------------------

const popularRow = document.getElementById("popularRow");

function renderPopularRow() {
  if (!popularRow) return;
  const items = TOPICS.filter(tpc => tpc.popular);
  popularRow.innerHTML = items
    .map((item) => {
      const dot = `<span class="popular__dot" aria-hidden="true"></span>`;
      return `<a class="popular__pill" href="${escapeHtml(item.url)}">${dot}${escapeHtml(t(item.titleKey))}</a>`;
    })
    .join("");
}

function initTopicPage() {
  const slug = document.body?.getAttribute('data-topic-slug');
  const titleEl = document.getElementById('topicPageTitle');
  if (!slug || !titleEl) return;

  const topic = TOPICS.find(tpc => tpc.slug === slug);
  if (!topic) return;

  // Set title + headline
  document.title = `${t(topic.titleKey)} | ${t('brand.name')}`;
  titleEl.textContent = t(topic.titleKey);

  const descEl = document.getElementById('topicPageDesc');
  if (descEl) descEl.textContent = t(topic.descKey);

  const metaEl = document.getElementById('topicPageMeta');
  if (metaEl) {
    const pills = [];
    pills.push(`<span class="pill">${escapeHtml(t(topic.levelKey))}</span>`);
    pills.push(`<span class="pill">${escapeHtml(t('cat.' + topic.category))}</span>`);
    (topic.tagKeys || []).slice(0, 6).forEach(k => pills.push(`<span class="pill">${escapeHtml(t(k))}</span>`));
    metaEl.innerHTML = pills.join('');
  }

  const comingTitle = document.getElementById('topicComingTitle');
  const comingText = document.getElementById('topicComingText');
  if (comingTitle) comingTitle.textContent = t('topic.coming.title');
  if (comingText) comingText.textContent = t('topic.coming.text');
}
const topicGrid = document.getElementById("topicGrid");
const examGrid = document.getElementById("examGrid");
const resourceGrid = document.getElementById("resourceGrid");

let activeFilter = "all";
const chips = Array.from(document.querySelectorAll(".chip"));
const searchInput = document.getElementById("topicSearch");

function applyFilters() {
  const q = (searchInput?.value || "").toLowerCase().trim();

  const filtered = TOPICS.filter((topic) => {
    const matchesFilter = activeFilter === "all" ? true : topic.category === activeFilter;
    const hay = `${t(topic.titleKey)} ${t(topic.descKey)} ${(topic.tagKeys || []).map(k=>t(k)).join(" ")} ${t(topic.levelKey)} ${t("cat." + topic.category)}`.toLowerCase();
    const matchesSearch = q ? hay.includes(q) : true;
    return matchesFilter && matchesSearch;
  });

  mountCards({ el: topicGrid, items: filtered, type: "topic" });
}

chips.forEach((chip) => {
  chip.addEventListener("click", () => {
    chips.forEach((c) => c.classList.remove("is-active"));
    chip.classList.add("is-active");
    activeFilter = chip.getAttribute("data-filter") || "all";
    applyFilters();
  });
});

if (searchInput) searchInput.addEventListener("input", applyFilters);

function renderAllCards() {
  renderPopularRow();
  mountCards({ el: topicGrid, items: TOPICS, type: "topic" });
  mountCards({ el: examGrid, items: EXAMS });
  mountCards({ el: resourceGrid, items: RESOURCES });
  applyFilters();
}

// -----------------------------
// Demo contact form (no backend)
// -----------------------------
const form = document.getElementById("contactForm");
const notice = document.getElementById("formNotice");

if (form && notice) {
  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const data = new FormData(form);
    const name = (data.get("name") || "").toString().trim();
    const purpose = (data.get("purpose") || "").toString().trim();

    notice.className = "form__notice success";
    notice.textContent =
      `${t("ui.formThanks")}${name ? " " + name : ""}! ` +
      (purpose ? `(${purpose}) ` : "") +
      t("ui.formReady");

    form.reset();
  });
}


// -----------------------------
// Quizzes (Differential - 3 levels)
// -----------------------------
const QUIZZES = {
  "diff-easy": {
    course: "Differential",
    levelKey: "quiz.easy",
    questions: [
      { p: "d/dx (x^7) = ?", o: ["7x^6", "x^6", "7x^7", "x^7"], a: 0, e: "Power rule: d/dx(x^n)=n x^(n-1)." },
      { p: "d/dx (5x^3) = ?", o: ["15x^2", "5x^2", "15x^3", "x^2"], a: 0, e: "Constant multiple rule." },
      { p: "d/dx (sin x) = ?", o: ["cos x", "-cos x", "sin x", "-sin x"], a: 0, e: "Basic trig derivative." },
      { p: "d/dx (e^x) = ?", o: ["e^x", "xe^(x-1)", "ln(x)", "1/x"], a: 0, e: "e^x is its own derivative." },
      { p: "d/dx (ln x) = ?", o: ["1/x", "ln x", "x", "e^x"], a: 0, e: "Derivative of ln(x)." },
      { p: "d/dx (x^2 + 4x - 9) = ?", o: ["2x + 4", "x + 4", "2x - 9", "2x + 4x"], a: 0, e: "Differentiate term by term." },
      { p: "Slope of f(x)=x^2 at x=3?", o: ["6", "9", "3", "12"], a: 0, e: "f'(x)=2x, so f'(3)=6." },
      { p: "d/dx (1/x) = ?", o: ["-1/x^2", "1/x^2", "-x", "x^(-1)"], a: 0, e: "Rewrite as x^(-1) then apply power rule." },
      { p: "d/dx (√x) = ?", o: ["1/(2√x)", "2√x", "√x", "1/√x"], a: 0, e: "√x = x^(1/2) ⇒ derivative is (1/2)x^(-1/2)." },
      { p: "If f'(2)=5, then slope of tangent at x=2 is…", o: ["5", "2", "f(2)", "0"], a: 0, e: "Derivative at a point = tangent slope." },
    ],
  },

  "diff-hard": {
    course: "Differential",
    levelKey: "quiz.hard",
    questions: [
      { p: "d/dx ( (3x^2 + 1)^5 ) = ?", o: ["30x(3x^2+1)^4", "5(3x^2+1)^4", "15x^2(3x^2+1)^4", " (3x^2+1)^5 "], a: 0, e: "Chain rule: outer 5( )^4 * inner derivative 6x." },
      { p: "d/dx (x^2 sin x) = ?", o: ["2x sin x + x^2 cos x", "x^2 cos x", "2x cos x + x^2 sin x", "sin x"], a: 0, e: "Product rule: (x^2)'sinx + x^2(sinx)'." },
      { p: "d/dx ( (x^2+1)/(x) ) = ?", o: ["(x^2-1)/x^2", "(x^2+1)/x^2", "2x/x", "1"], a: 0, e: "Simplify: (x^2+1)/x = x + 1/x ⇒ derivative 1 - 1/x^2 = (x^2-1)/x^2." },
      { p: "d/dx (ln(5x)) = ?", o: ["1/x", "5/x", "ln(5)", "1/(5x)"], a: 0, e: "ln(5x)=ln5+lnx ⇒ derivative 1/x." },
      { p: "Implicit: if x^2 + y^2 = 25, dy/dx = ?", o: ["-x/y", "-y/x", "x/y", "y/x"], a: 0, e: "Differentiate: 2x + 2y y' = 0 ⇒ y' = -x/y." },
      { p: "Tangent line to f(x)=x^3 at x=2:", o: ["y=12(x-2)+8", "y=6(x-2)+8", "y=12x+8", "y=8(x-2)+12"], a: 0, e: "f'(x)=3x^2 ⇒ f'(2)=12; point is (2,8)." },
      { p: "d/dx (e^{2x}) = ?", o: ["2e^{2x}", "e^{2x}", "2xe^{2x}", "e^x"], a: 0, e: "Chain rule: derivative of 2x is 2." },
      { p: "Critical points occur when…", o: ["f'(x)=0 or undefined", "f(x)=0", "f''(x)=0 always", "x=0 only"], a: 0, e: "Critical points: where derivative is 0 or does not exist." },
      { p: "If f''(x) > 0 on an interval, f is…", o: ["concave up", "concave down", "decreasing", "constant"], a: 0, e: "Second derivative test for concavity." },
      { p: "d/dx ( (sin x)/(x^2) ) = ?", o: ["(x^2 cos x - 2x sin x)/x^4", "(cos x)/(x^2)", "(x^2 cos x + 2x sin x)/x^4", "cos x / x"], a: 0, e: "Quotient: (u/v)'=(u'v-uv')/v^2 with u=sinx, v=x^2." },
    ],
  },

  "diff-vhard": {
    course: "Differential",
    levelKey: "quiz.veryHard",
    questions: [
      { p: "Log diff: d/dx (x^x) = ?", o: ["x^x(ln x + 1)", "x^{x-1}", "x^x ln x", "ln(x^x)"], a: 0, e: "Let y=x^x ⇒ ln y = x ln x ⇒ y'/y = ln x + 1." },
      { p: "d/dx (ln(x^2+1)) = ?", o: ["2x/(x^2+1)", "1/(x^2+1)", "2/(x^2+1)", "ln(x^2+1)"], a: 0, e: "Chain rule: (ln u)' = u'/u." },
      { p: "Implicit: y e^y = x, dy/dx = ?", o: ["1/(e^y(1+y))", "e^y", "1/(1+y)", "e^{-y}(1+y)"], a: 0, e: "Differentiate: (y e^y)'=y'e^y + y e^y y' = y'e^y(1+y)=1." },
      { p: "Find x of local max for f(x)=-x^2+4x+1:", o: ["2", "4", "-2", "0"], a: 0, e: "Vertex at x=-b/(2a)= -4/(2(-1))=2." },
      { p: "Newton step for f(x)=x^2-2 from x0=1:", o: ["x1=1.5", "x1=1", "x1=2", "x1=0.5"], a: 0, e: "x1=x0 - f/f' = 1 - (-1)/(2)=1.5." },
      { p: "If f'(x)>0 and f''(x)<0, the graph is…", o: ["increasing & concave down", "decreasing & concave up", "increasing & concave up", "decreasing & concave down"], a: 0, e: "Signs: f' controls inc/dec, f'' controls concavity." },
      { p: "Where is f(x)=|x| NOT differentiable?", o: ["x=0", "x=1", "x=-1", "everywhere"], a: 0, e: "Corner at 0." },
      { p: "Related rates style: If A=πr^2 and dr/dt=3, then dA/dt = ?", o: ["6πr", "2πr", "3πr^2", "9π"], a: 0, e: "Differentiate: dA/dt=2πr dr/dt = 6πr." },
      { p: "Second derivative test: if f'(c)=0 and f''(c)<0 then c is…", o: ["local maximum", "local minimum", "inflection point", "undefined"], a: 0, e: "Negative second derivative ⇒ concave down ⇒ max." },
      { p: "d/dx (arctan x) = ?", o: ["1/(1+x^2)", "1/√(1-x^2)", "1/(1-x)", "tan x"], a: 0, e: "Standard inverse trig derivative." },
    ],
  },
};

function getQuizSetFromURL() {
  const sp = new URLSearchParams(window.location.search);
  return sp.get("set") || "diff-easy";
}

function quizBestKey(setId) {
  return `quiz_best_${setId}`;
}

function initQuizPage() {
  const isQuiz = document.body?.getAttribute("data-page") === "quiz";
  if (!isQuiz) return;

  const mount = document.getElementById("quizMount");
  const notice = document.getElementById("quizNotice");
  const submitBtn = document.getElementById("quizSubmitBtn");
  const retryBtn = document.getElementById("quizRetryBtn");
  const resetBtn = document.getElementById("quizResetBtn");

  const setPill = document.getElementById("quizSetPill");
  const countPill = document.getElementById("quizCountPill");
  const bestPill = document.getElementById("quizBestPill");

  if (!mount || !notice || !submitBtn || !retryBtn || !resetBtn) return;

  let activeSet = getQuizSetFromURL();
  let locked = false;

  function setActiveChip(setId) {
    document.querySelectorAll(".quiz-level").forEach(btn => {
      btn.classList.toggle("is-active", btn.getAttribute("data-quiz-set") === setId);
    });
  }

  function render(setId) {
    activeSet = setId;
    locked = false;
    notice.className = "form__notice";
    notice.textContent = "";
    retryBtn.style.display = "none";
    submitBtn.style.display = "";

    const qz = QUIZZES[setId];
    if (!qz) return;

    // meta pills
    setPill.textContent = qz.course;
    countPill.textContent = `${qz.questions.length} questions`;

    const best = localStorage.getItem(quizBestKey(setId));
    bestPill.textContent = best ? `Best: ${best}%` : "Best: —";

    setActiveChip(setId);

    mount.innerHTML = qz.questions.map((q, idx) => {
      const name = `q_${idx}`;
      const opts = q.o.map((opt, j) => {
        return `
          <label class="quiz-opt">
            <input type="radio" name="${name}" value="${j}" />
            <span>${escapeHtml(opt)}</span>
          </label>
        `;
      }).join("");

      return `
        <div class="quiz-q" data-q="${idx}">
          <div class="quiz-q__top">
            <div class="quiz-q__num">Q${idx + 1}</div>
          </div>
          <div class="quiz-q__prompt">${escapeHtml(q.p)}</div>
          <div class="quiz-opts">${opts}</div>
          <div class="quiz-exp" style="display:none;"></div>
        </div>
      `;
    }).join("");
  }

  function grade() {
    const qz = QUIZZES[activeSet];
    if (!qz) return;

    const blocks = Array.from(mount.querySelectorAll(".quiz-q"));
    let correct = 0;

    // check all answered
    for (const b of blocks) {
      const qi = Number(b.getAttribute("data-q"));
      const chosen = b.querySelector('input[type="radio"]:checked');
      if (!chosen) {
        notice.className = "form__notice success";
        notice.textContent = t("quiz.missing");
        return;
      }
    }

    locked = true;

    blocks.forEach((b) => {
      const qi = Number(b.getAttribute("data-q"));
      const q = qz.questions[qi];

      const chosen = b.querySelector('input[type="radio"]:checked');
      const picked = Number(chosen.value);

      const optLabels = Array.from(b.querySelectorAll(".quiz-opt"));
      optLabels.forEach((lab, j) => {
        lab.classList.remove("is-correct", "is-wrong");
        const input = lab.querySelector("input");
        input.disabled = true;

        if (j === q.a) lab.classList.add("is-correct");
        if (j === picked && picked !== q.a) lab.classList.add("is-wrong");
      });

      if (picked === q.a) correct++;

      const exp = b.querySelector(".quiz-exp");
      exp.style.display = "block";
      exp.textContent = q.e;
    });

    const pct = Math.round((correct / qz.questions.length) * 100);

    // save best
    const prev = Number(localStorage.getItem(quizBestKey(activeSet)) || "0");
    if (pct > prev) localStorage.setItem(quizBestKey(activeSet), String(pct));

    notice.className = "form__notice success";
    notice.textContent = `${t("quiz.scoreLine")}: ${correct}/${qz.questions.length} (${pct}%)`;

    submitBtn.style.display = "none";
    retryBtn.style.display = "";
    bestPill.textContent = `Best: ${Math.max(prev, pct)}%`;
  }

  // Level buttons
  document.querySelectorAll("[data-quiz-set]").forEach((btn) => {
    btn.addEventListener("click", () => {
      const setId = btn.getAttribute("data-quiz-set");
      const url = new URL(window.location.href);
      url.searchParams.set("set", setId);
      history.replaceState({}, "", url);
      render(setId);
    });
  });

  submitBtn.addEventListener("click", () => {
    if (!locked) grade();
  });

  retryBtn.addEventListener("click", () => render(activeSet));

  resetBtn.addEventListener("click", () => {
    localStorage.removeItem(quizBestKey(activeSet));
    render(activeSet);
  });

  // initial render
  render(activeSet);
}


// Init
setLanguage(getLang());
initTopicPage();
initQuizPage();

